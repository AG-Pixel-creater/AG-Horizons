rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Restrict writes that include obvious adult keywords in filenames and
    // ensure content types are reasonable for their target (image/video).
    match /{allPaths=**} {
      allow read: if true;

      // Deny writes if the path or filename contains blocked keywords
      function blockedFilenameRegex() {
        return '(?i)\\b(porn|pornhub|xvideos|xhamster|xnxx|redtube|youporn|pornography|porn.com|adult|xxx|escort|cam|hentai|nsfw|nude|erotic|sex)\\b';
      }

      allow write: if (
        // Must have a content type on upload
        request.resource != null
        // refuse files with blocked keywords in path
        && !(allPaths.matches(blockedFilenameRegex()))
        && (
          // images may have image content type
          (request.resource.contentType.matches('image/.*'))
          ||
          // videos may have video content type
          (request.resource.contentType.matches('video/.*'))
        )
      );
    }
  }
}
